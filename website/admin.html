<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#041833">
  <link rel="stylesheet" href="style.css">
  <title>Research Team | Admin</title>
</head>
<body>
  <div class="corner-banner" aria-hidden="true"></div>
  <header>
    <h1>Admin Panel</h1>
    <nav>
      <a href="index.html">Home</a> |
      <a href="researchers.html">Researchers</a> |
      <a href="projects.html">Projects</a> |
      <a href="publications.html">Publications</a> |
      <a href="admin.html">Admin</a>
    </nav>
  </header>
  <main>
    <section>
      <h2>Login</h2>
      <p class="muted">Enter credentials to manage researchers.</p>
      <form id="login-form" class="admin-form">
        <label>
          Username
          <input type="text" id="username" autocomplete="username" required>
        </label>
        <label>
          Password
          <input type="password" id="password" autocomplete="current-password" required>
        </label>
        <button type="submit" class="primary-btn">Login</button>
        <p id="login-error" class="error-text"></p>
      </form>
    </section>

    <section id="admin-area" hidden>
      <h2>Manage Researchers</h2>
      <p class="muted">Add, edit, or remove researchers. Changes are stored locally in your browser.</p>
      <div class="admin-actions">
        <button id="add-btn" class="secondary-btn">Add New Researcher</button>
        <button id="reset-btn" class="ghost-btn">Reset to Default</button>
      </div>
      <div id="editor" class="admin-form" hidden>
        <h3 id="editor-title">New Researcher</h3>
        <label>
          Name
          <input type="text" id="field-name" required>
        </label>
        <label>
          Title
          <input type="text" id="field-title" required>
        </label>
        <label>
          Description
          <textarea id="field-description" rows="3" required></textarea>
        </label>
        <label>
          Image URL / Path
          <input type="text" id="field-image" placeholder="e.g. Theofilos.png">
        </label>
        <div class="admin-actions">
          <button id="save-btn" class="primary-btn">Save</button>
          <button id="cancel-btn" class="ghost-btn" type="button">Cancel</button>
        </div>
      </div>
      <div id="list" class="admin-list"></div>
    </section>
  </main>
  <script>
    (function admin() {
      const loginForm = document.getElementById('login-form');
      const loginError = document.getElementById('login-error');
      const adminArea = document.getElementById('admin-area');
      const addBtn = document.getElementById('add-btn');
      const resetBtn = document.getElementById('reset-btn');
      const editor = document.getElementById('editor');
      const editorTitle = document.getElementById('editor-title');
      const saveBtn = document.getElementById('save-btn');
      const cancelBtn = document.getElementById('cancel-btn');
      const listEl = document.getElementById('list');
      const nameField = document.getElementById('field-name');
      const titleField = document.getElementById('field-title');
      const descField = document.getElementById('field-description');
      const imageField = document.getElementById('field-image');

      const STORAGE_KEY = 'researchersData';
      const DEFAULT_DATA = [
        {
          name: 'Theofilos',
          title: 'Principal Investigator',
          description: 'Leads translational AI projects and coordinates collaborations across clinical and data science teams.',
          image: 'Theofilos.png'
        },
        {
          name: 'John Doe',
          title: 'Senior Research Scientist',
          description: 'Focuses on applied research bridging theoretical insights with practical solutions in healthcare.',
          image: 'https://via.placeholder.com/160x160.png?text=John+Doe'
        },
        {
          name: 'Alex Kim',
          title: 'Research Fellow',
          description: 'Explores data quality, fairness, and robustness while prototyping next-generation clinical decision tools.',
          image: 'https://via.placeholder.com/160x160.png?text=Alex+Kim'
        }
      ];

      let editingIndex = null;

      function loadData() {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return [...DEFAULT_DATA];
        try {
          const parsed = JSON.parse(raw);
          return Array.isArray(parsed) ? parsed : [...DEFAULT_DATA];
        } catch {
          return [...DEFAULT_DATA];
        }
      }

      function saveData(data) {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
      }

      function renderList() {
        const data = loadData();
        listEl.innerHTML = '';
        if (!data.length) {
          listEl.innerHTML = '<p class="muted">No researchers yet. Add one to get started.</p>';
          return;
        }
        data.forEach((person, idx) => {
          const row = document.createElement('div');
          row.className = 'admin-row';
          const info = document.createElement('div');
          info.className = 'admin-info';
          const name = document.createElement('h4');
          name.textContent = person.name || 'Unnamed';
          const title = document.createElement('p');
          title.className = 'muted';
          title.textContent = person.title || '';
          info.appendChild(name);
          info.appendChild(title);
          const actions = document.createElement('div');
          actions.className = 'admin-row-actions';
          const editBtn = document.createElement('button');
          editBtn.className = 'secondary-btn';
          editBtn.textContent = 'Edit';
          editBtn.onclick = () => openEditor(idx, person);
          const delBtn = document.createElement('button');
          delBtn.className = 'ghost-btn';
          delBtn.textContent = 'Delete';
          delBtn.onclick = () => {
            const updated = loadData().filter((_, i) => i !== idx);
            saveData(updated);
            renderList();
          };
          actions.appendChild(editBtn);
          actions.appendChild(delBtn);
          row.appendChild(info);
          row.appendChild(actions);
          listEl.appendChild(row);
        });
      }

      function openEditor(index, person = null) {
        editingIndex = index;
        editorTitle.textContent = index === null ? 'New Researcher' : 'Edit Researcher';
        nameField.value = person?.name || '';
        titleField.value = person?.title || '';
        descField.value = person?.description || '';
        imageField.value = person?.image || '';
        editor.hidden = false;
        nameField.focus();
      }

      function closeEditor() {
        editingIndex = null;
        editor.hidden = true;
        nameField.value = '';
        titleField.value = '';
        descField.value = '';
        imageField.value = '';
      }

      loginForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const user = document.getElementById('username').value.trim();
        const pass = document.getElementById('password').value;
        if (user === 'admin' && pass === 'northwell') {
          loginError.textContent = '';
          loginForm.hidden = true;
          adminArea.hidden = false;
          renderList();
        } else {
          loginError.textContent = 'Invalid credentials';
        }
      });

      addBtn.addEventListener('click', () => openEditor(null));
      resetBtn.addEventListener('click', () => {
        saveData(DEFAULT_DATA);
        renderList();
      });
      cancelBtn.addEventListener('click', closeEditor);

      saveBtn.addEventListener('click', (e) => {
        e.preventDefault();
        const next = {
          name: nameField.value.trim(),
          title: titleField.value.trim(),
          description: descField.value.trim(),
          image: imageField.value.trim()
        };
        if (!next.name || !next.title || !next.description) {
          alert('Name, title, and description are required.');
          return;
        }
        const data = loadData();
        if (editingIndex === null) {
          data.push(next);
        } else {
          data[editingIndex] = next;
        }
        saveData(data);
        renderList();
        closeEditor();
      });
    })();
  </script>
</body>
</html>
