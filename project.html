<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#041833">
  <link rel="stylesheet" href="style.css">
  <title>Research Team | Project</title>
</head>
<body>
  <header>
    <h1 id="project-title">Project</h1>
    <nav>
      <a href="index.html">Home</a> |
      <a href="researchers.html">Researchers</a> |
      <a href="projects.html">Projects</a> |
      <a href="publications.html">Publications</a> |
      <a href="admin.html">Admin</a>
    </nav>
  </header>
  <main id="project-main">
    <section class="project-hero">
      <div class="project-hero-image" id="project-hero-image"></div>
      <div class="project-hero-body">
        <h2 id="project-name"></h2>
        <p id="project-summary" class="muted"></p>
        <div id="project-leads" class="project-leads"></div>
        <div id="project-details" class="project-details-list"></div>
      </div>
    </section>
    <section id="project-slides">
      <h3>Slides</h3>
      <div id="slides-grid" class="slides-grid"></div>
    </section>
  </main>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script src="data.js"></script>
  <script>
    (function loadProject() {
      const params = new URLSearchParams(window.location.search);
      const slug = params.get('slug');
      const heroEl = document.getElementById('project-hero-image');

      function setHero(project) {
        heroEl.innerHTML = '';
        heroEl.classList.remove('project-cover-placeholder');
        if (project.cover) {
          const img = document.createElement('img');
          img.src = project.cover;
          img.alt = project.title || 'Project cover';
          img.onerror = () => {
            img.remove();
            heroEl.textContent = project.title || 'Project Overview';
            heroEl.classList.add('project-cover-placeholder');
          };
          heroEl.appendChild(img);
        } else {
          heroEl.textContent = project.title || 'Project Overview';
          heroEl.classList.add('project-cover-placeholder');
        }
      }

      SiteData.getProjectBySlug(slug)
        .then(project => {
          if (!project) {
            document.getElementById('project-main').innerHTML = '<p class="muted">Project not found.</p>';
            document.title = 'Project not found';
            return;
          }

          document.title = project.title || 'Project';
          document.getElementById('project-title').textContent = project.title || 'Project';
          document.getElementById('project-name').textContent = project.title || 'Project';
          document.getElementById('project-summary').textContent = project.summary || '';
          setHero(project);

          const leadsEl = document.getElementById('project-leads');
          leadsEl.innerHTML = '';
          (project.leads || []).forEach(lead => {
            const chip = document.createElement('a');
            chip.className = 'lead-chip';
            chip.href = `researcher.html?slug=${encodeURIComponent(lead.slug)}`;
            chip.textContent = lead.title ? `${lead.name} - ${lead.title}` : lead.name;
            leadsEl.appendChild(chip);
          });

          const detailEl = document.getElementById('project-details');
          detailEl.innerHTML = '';
          (project.details || []).forEach(item => {
            const row = document.createElement('p');
            row.textContent = item;
            detailEl.appendChild(row);
          });

          const slidesGrid = document.getElementById('slides-grid');
          slidesGrid.innerHTML = '';
          if (!project.slides || !project.slides.length) {
            slidesGrid.innerHTML = '<p class="muted">Slides will appear here when available.</p>';
            return;
          }

          project.slides.forEach(slide => {
            const card = document.createElement('article');
            card.className = 'slide-card';
            if (slide.image) {
              const img = document.createElement('img');
              img.src = slide.image;
              img.alt = slide.title || 'Slide';
              img.onerror = () => img.remove();
              card.appendChild(img);
            }
            const body = document.createElement('div');
            body.className = 'slide-body';
            const title = document.createElement('h4');
            title.textContent = slide.title || 'Slide';
            const caption = document.createElement('p');
            caption.className = 'muted';
            caption.textContent = slide.caption || '';
            body.appendChild(title);
            body.appendChild(caption);
            card.appendChild(body);
            slidesGrid.appendChild(card);
          });
        })
        .catch(err => {
          console.error('Failed to load project:', err);
          document.getElementById('project-main').innerHTML = '<p class="muted">Unable to load project. Check the Excel file.</p>';
        });
    })();
  </script>
</body>
</html>
